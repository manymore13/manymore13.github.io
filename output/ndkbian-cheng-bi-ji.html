<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>NDK编程笔记 &mdash; manymore13'notes</title>
  <meta name="author" content="manymore13">






  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="/favicon.png" rel="icon">

  <link href="/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="/">manymore13'notes</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>


<ul class="main-navigation">
      <li class="active">
        <a href="/category/android_notes.html">Android_notes</a>
      </li>
      <li >
        <a href="/category/financial_notes.html">Financial_notes</a>
      </li>
      <li >
        <a href="/category/gu-zhi-gong-ju.html">估值工具</a>
      </li>
      <li >
        <a href="/category/java_notes.html">Java_notes</a>
      </li>
      <li >
        <a href="/category/ji-suan-ji.html">计算机</a>
      </li>
      <li >
        <a href="/category/jie-zhi.html">价值</a>
      </li>
      <li >
        <a href="/category/life_notes.html">Life_notes</a>
      </li>
      <li >
        <a href="/category/python_notes.html">Python_notes</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">NDK编程笔记</h1>
    <p class="meta">
<time datetime="2020-01-02T14:23:38+08:00" pubdate>Thu 02 January 2020</time>    </p>
</header>

  <div class="entry-content"><ul>
<li>技术</li>
<li>Android
tags: </li>
<li>Android</li>
<li>NDK</li>
</ul>
<hr>
<h2><a href="https://gitee.com/mirrors/ffmpeg">FFMpeg国内镜像</a></h2>
<h2>参考链接</h2>
<ol>
<li><a href="https://developer.android.google.cn/ndk/guides">NDK指南</a></li>
<li><a href="https://developer.android.google.cn/ndk/reference">NDK库Api</a></li>
<li><a href="https://developer.android.google.cn/ndk/samples">官方例子</a></li>
<li><a href="https://blog.csdn.net/han1202012/category_9493908.html">Android NDK 开发-韩曙亮</a></li>
<li><a href="https://blog.csdn.net/u011609853/article/details/105648099">NDK r21编译FFmpeg 4.2.2（x86、x86_64、armv7、armv8）</a></li>
<li><a href="https://github.com/Javernaut/ffmpeg-android-maker">ffmpeg-android-maker</a>,<a href="https://github.com/Javernaut/ffmpeg-android-maker/wiki/Setting-the-FFmpeg-version">wiki</a>
推荐使用这个脚本编译FFmpeg</li>
</ol>
<div class="highlight"><pre><span></span><code>./ffmpeg-android-maker.sh<span class="w"> </span>-abis<span class="o">=</span>x86_64<span class="w"> </span>-android<span class="o">=</span><span class="m">21</span><span class="w"> </span>--source-git-branch<span class="o">=</span>release/4.2.3
</code></pre></div>

<ol>
<li><a href="http://trac.ffmpeg.org/wiki/CompilationGuide/Android">wikiCompilationGuide/Android</a> </li>
<li><a href="https://trac.ffmpeg.org/wiki/CompilationGuide/Generic">FFmpeg官方WIKI</a></li>
<li><a href="https://blog.csdn.net/lbcab/article/details/72771729">Android gradle SourceSets介绍与使用</a></li>
<li><a href="https://blog.csdn.net/chaoqiangscu/article/details/83023762">Android：JNI调用C++自定义类的详细方法</a></li>
</ol>
<h2>概念</h2>
<ol>
<li>NDK是什么？
一套可以帮助你把原生代码(c/c++)嵌入到Android应用中的工具</li>
<li>适用性
重用已经有的原生库，计算密集型应用用原生代码可以提高性能，比如游戏</li>
<li><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/jniTOC.html">JNI ORACLE官方介绍</a></li>
<li><a href="https://blog.csdn.net/u013278099/article/details/52003759">了解JNI动态注册native方法</a>   </li>
</ol>
<h2>编译流程</h2>
<div class="highlight"><pre><span></span><code><span class="nf">graph</span><span class="w"> </span><span class="n">LR</span>
<span class="n">A</span><span class="p">(</span><span class="err">预处理</span><span class="p">)</span><span class="o">--&gt;</span><span class="n">B</span><span class="p">(</span><span class="err">编译</span><span class="p">)</span>
<span class="n">B</span><span class="o">--&gt;</span><span class="n">C</span><span class="p">(</span><span class="err">汇编</span><span class="p">)</span>
<span class="n">C</span><span class="o">--&gt;</span><span class="n">D</span><span class="p">(</span><span class="err">链接</span><span class="p">)</span>
</code></pre></div>

<ul>
<li><strong>预处理(Preprocessing)</strong>
   完成宏替换，文件引入，以及去除空行，注释等，为下一步编译做准备。也就是对各种预处理命令进行处理，包括头文件的包含，宏定义的扩展，条件编译的选择等。
    <code>shell
    gcc -E test.c -o test.i</code>
选项-E让gcc在预处理结束后停止编译，test.i文件为预处理后输出的文件。-o指定输出文件</li>
<li>
<p><strong>编译(Compilation)</strong>
<img alt="编译" src="../Other_Notes/img/编译.png"><br>
<code>shell
    gcc -S test.i -o test.s</code>
选项-S让gcc在编译结束后停止编译过程,test.s文件为编译后生成的汇编代码。</p>
</li>
<li>
<p><strong>汇编</strong>
  汇编就是把编译阶段生成的.s文件转成二进制<strong>目标代码</strong>，也就是机器代码(01序列)。
    <code>shell
    gcc -c test.s -o test.o</code>
选项-c让gcc在汇编结束后停止编译过程，test.o文件为生成的机器码目标文件。</p>
</li>
<li>
<p><strong>链接</strong>
链接就是将多个目标文件以及所需的库文件链接生成可执行目标文件的过程。
    <code>shell
    gcc test.o -o test</code>
    -o本质上是一个重命名选项。不使用-o选项时，默认生成的是a.out文件</p>
</li>
<li><strong>一次性生成可执行文件</strong>
  <code>shell
  gcc -o test test.c</code></li>
</ul>
<h2>静态库与动态库</h2>
<p><a href="https://www.cnblogs.com/codingmengmeng/p/6046481.html">静态库和动态库的区别</a></p>
<h2>CMake使用</h2>
<p><a href="https://blog.csdn.net/bigdog_1027/article/details/79113342">cmake学习笔记之add_library、target_link_libraries和link_directories</a>
<a href="https://www.jianshu.com/p/e51547d288fd">FFmpeg（四）：CMake移植FFmpeg的静态库到AndroidStudio中</a></p>
<h2>编译工具(推荐使用CMake)</h2>
<ol>
<li><a href="https://blog.csdn.net/xiaoyu_93/article/details/53082088">CMake,Ndkbuild不同配置方法以及区别</a>   </li>
<li><a href="https://developer.android.google.cn/studio/projects/configure-cmake#add-ndk-api">配置CMake-官方</a></li>
<li><a href="https://developer.android.google.cn/studio/projects/configure-cmake#add-ndk-api">如何添加NDK API</a>
添加ndk中的日志打印库</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">cmake_minimum_required</span><span class="p">(</span><span class="n">VERSION</span><span class="w"> </span><span class="mf">3.4.1</span><span class="p">)</span>
<span class="n">include_directories</span><span class="p">(</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">cpp</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="w"> </span><span class="p">)</span>

<span class="n">add_library</span><span class="p">(</span><span class="n">hello</span><span class="o">-</span><span class="n">jni</span><span class="w"> </span><span class="n">SHARED</span>
<span class="w">            </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">cpp</span><span class="o">/</span><span class="n">Hello</span><span class="p">.</span><span class="na">c</span><span class="p">)</span>

<span class="n">add_library</span><span class="p">(</span><span class="n">callC</span><span class="w"> </span><span class="n">SHARED</span>
<span class="w">        </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">cpp</span><span class="o">/</span><span class="n">javaCallC</span><span class="p">.</span><span class="na">c</span><span class="p">)</span>

<span class="n">add_library</span><span class="p">(</span><span class="n">calljava</span><span class="w"> </span><span class="n">SHARED</span>
<span class="w">        </span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">cpp</span><span class="o">/</span><span class="n">cCallJava</span><span class="p">.</span><span class="na">cpp</span><span class="p">)</span>

<span class="n">find_library</span><span class="p">(</span><span class="n">log</span><span class="o">-</span><span class="n">lib</span>
<span class="w">        </span><span class="n">log</span><span class="p">)</span>

<span class="err">#</span><span class="w"> </span><span class="n">Include</span><span class="w"> </span><span class="n">libraries</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">hello</span><span class="o">-</span><span class="n">jni</span><span class="w"> </span><span class="n">lib</span>
<span class="nf">target_link_libraries</span><span class="p">(</span><span class="n">hello</span><span class="o">-</span><span class="n">jni</span>
<span class="w">                      </span><span class="n">android</span>
<span class="w">                      </span><span class="n">log</span><span class="p">)</span>
<span class="n">target_link_libraries</span><span class="p">(</span><span class="w"> </span><span class="n">calljava</span><span class="w">  </span><span class="n">$</span><span class="p">{</span><span class="n">log</span><span class="o">-</span><span class="n">lib</span><span class="p">}</span><span class="w"> </span><span class="p">)</span>
</code></pre></div>

<p>具体配置介绍参考 <a href="https://developer.android.google.cn/studio/projects/configure-cmake#add-ndk-api">配置CMake-官方</a></p>
<h2>命令</h2>
<ol>
<li>生成头文件:javah -d 存放的目录　完整类</li>
<li>查看方法签名:javap　-s 完整类</li>
<li>kotlin类头文件生成必须要到 路径(app/build/tmp/kotlin-classes/debug)下javah </li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">javap</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="na">cn</span><span class="p">.</span><span class="na">katefm</span><span class="p">.</span><span class="na">jni</span><span class="p">.</span><span class="na">CcallJava</span>
</code></pre></div>

<h2>java调用C</h2>
<p>直接看源码
java或者kotlin要调用ｃ/c++函数，必须声明native方法
他们用的关键字不一样。</p>
<div class="highlight"><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.cn.katefm.jni</span>

<span class="cm">/**</span>
<span class="cm"> * c代码调用java代码</span>
<span class="cm"> * 查看该类所有方法签名</span>
<span class="cm"> * ~/AndroidStudioProjects/KateFM/app/build/tmp/kotlin-classes/debug$ javap -s com.cn.katefm.jni.CcallJava</span>
<span class="cm"> */</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">CcallJava</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">loadLibrary</span><span class="p">(</span><span class="s">&quot;calljava&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">external</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">cCallmultiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="kt">Int</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 乘法运算</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span>

<span class="p">}</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nn">com.cn.katefm.jni</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * java代码调用C代码</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JavaCallC</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">loadLibrary</span><span class="p">(</span><span class="s">&quot;callC&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 两数想家</span>
<span class="cm">     * @param x</span>
<span class="cm">     * @param y</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">native</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 字符串拼接</span>
<span class="cm">     * @param s</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">native</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">sayHello</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 修改字符串值并返回</span>
<span class="cm">     * @param intArray</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">native</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="nf">increaseArrayEles</span><span class="p">(</span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">intArray</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * 密码检验</span>
<span class="cm">     * @param pwd 密码</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">native</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">checkPwd</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">pwd</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">//</span>
<span class="c1">// Created by manymore13 on 20-6-15.</span>
<span class="c1">//</span>
<span class="c1">// https://developer.android.com/studio/projects/configure-cmake</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;jni.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;com_cn_katefm_jni_JNI.h&quot;</span>


<span class="n">jint</span><span class="w"> </span><span class="nf">Java_com_cn_katefm_jni_JavaCallC_add</span>
<span class="w">        </span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">jobj</span><span class="p">,</span><span class="w"> </span><span class="n">jint</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">jint</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">jstring</span><span class="w"> </span><span class="nf">Java_com_cn_katefm_jni_JavaCallC_sayHello</span>
<span class="w">        </span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">jobj</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">jniStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;我是jni&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">jStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetStringUTFChars</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">jniStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strcat</span><span class="p">(</span><span class="n">jniStr</span><span class="p">,</span><span class="w"> </span><span class="n">jStr</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jniStr</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">JNIEXPORT</span><span class="w"> </span><span class="n">jintArray</span><span class="w"> </span><span class="n">JNICALL</span><span class="w"> </span><span class="n">Java_com_cn_katefm_jni_JavaCallC_increaseArrayEles</span>
<span class="w">        </span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">jobj</span><span class="p">,</span><span class="w"> </span><span class="n">jintArray</span><span class="w"> </span><span class="n">jArray</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetArrayLength</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jArray</span><span class="p">);</span>
<span class="w">    </span><span class="n">jint</span><span class="w"> </span><span class="o">*</span><span class="n">jIntArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetIntArrayElements</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jArray</span><span class="p">,</span><span class="w"> </span><span class="n">JNI_FALSE</span><span class="p">);</span>
<span class="w">    </span><span class="n">jintArray</span><span class="w"> </span><span class="n">resultArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewIntArray</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">jint</span><span class="w"> </span><span class="o">*</span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jIntArray</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="o">*</span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">+</span><span class="mi">10</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">SetIntArrayRegion</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">resultArray</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"> </span><span class="n">jIntArray</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">resultArray</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">JNIEXPORT</span><span class="w"> </span><span class="n">jint</span><span class="w"> </span><span class="n">JNICALL</span><span class="w"> </span><span class="n">Java_com_cn_katefm_jni_JavaCallC_checkPwd</span>
<span class="w">        </span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">jobj</span><span class="p">,</span><span class="w"> </span><span class="n">jstring</span><span class="w"> </span><span class="n">passWord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;123456&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">userPassWord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetStringUTFChars</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">passWord</span><span class="p">,</span><span class="w"> </span><span class="n">JNI_FALSE</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strcmp</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">userPassWord</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">400</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<h2>C调用java</h2>
<div class="highlight"><pre><span></span><code><span class="c1">//</span>
<span class="c1">// Created by manymore13 on 20-6-16.</span>
<span class="c1">//</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;com_cn_katefm_jni_CcallJava.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;android/log.h&gt;</span>

<span class="cp">#define  LOG_TAG  &quot;test&quot;</span>
<span class="cp">#define LOGI(...)  __android_log_print(ANDROID_LOG_INFO, LOG_TAG, __VA_ARGS__)</span>
<span class="cp">#define LOGE(...)  __android_log_print(ANDROID_LOG_ERROR, LOG_TAG, __VA_ARGS__)</span>
<span class="cp">#define LOGD(...)  __android_log_print(ANDROID_LOG_INFO, LOG_TAG, __VA_ARGS__)</span>

<span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">JNIEXPORT</span><span class="w"> </span><span class="n">jint</span><span class="w"> </span><span class="n">JNICALL</span><span class="w"> </span><span class="n">Java_com_cn_katefm_jni_CcallJava_cCallmultiply</span>
<span class="w">        </span><span class="p">(</span><span class="n">JNIEnv</span><span class="w"> </span><span class="o">*</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="n">jobject</span><span class="w"> </span><span class="n">jobj</span><span class="p">,</span><span class="w"> </span><span class="n">jint</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">jint</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//1. 得到字节码</span>
<span class="w">    </span><span class="n">jclass</span><span class="w"> </span><span class="n">jclazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">(</span><span class="s">&quot;com/cn/katefm/jni/CcallJava&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//2. 得到方法</span>
<span class="w">    </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">jmethodId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">-&gt;</span><span class="n">GetMethodID</span><span class="p">(</span><span class="n">jclazz</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;multiply&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;(II)I&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//3.实例化该类语言打印日志</span>
<span class="w">    </span><span class="c1">//jobject  jobject = env-&gt;AllocObject(jclazz);</span>
<span class="w">    </span><span class="c1">//4.调用该方法</span>
<span class="w">    </span><span class="n">LOGD</span><span class="p">(</span><span class="s">&quot;我是日志打印&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">env</span><span class="o">-&gt;</span><span class="n">CallIntMethod</span><span class="p">(</span><span class="n">jobj</span><span class="p">,</span><span class="n">jmethodId</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>

<p>native层调用java层弹Toast</p>
<div class="highlight"><pre><span></span><code><span class="n">jclass</span><span class="w"> </span><span class="n">jclazz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">-&gt;</span><span class="n">FindClass</span><span class="p">(</span><span class="s">&quot;com/cn/katefm/MainActivity&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">jmethodID</span><span class="w"> </span><span class="n">jmethodId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="o">-&gt;</span><span class="n">GetMethodID</span><span class="p">(</span><span class="n">jclazz</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;showToast&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;(Ljava/lang/String;)V&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">env</span><span class="o">-&gt;</span><span class="n">CallVoidMethod</span><span class="p">(</span><span class="n">thiz</span><span class="p">,</span><span class="w"> </span><span class="n">jmethodId</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">);</span>
</code></pre></div>

<h2>BUG</h2>
<ol>
<li><a href="https://blog.csdn.net/guyuealian/article/details/78310025">解决Error: undefined reference to `__android_log_print'</a></li>
</ol></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        manymore13
    </span>
  </span>
<time datetime="2020-01-02T14:23:38+08:00" pubdate>Thu 02 January 2020</time>  <span class="categories">
    <a class='category' href='/category/android_notes.html'>Android_Notes</a>
  </span>
</p><div class="sharing">
</div>    </footer>
  </article>

</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="/ji-zhu-wen-zhang-sou-ji.html">技术文章搜集</a>
      </li>
      <li class="post">
          <a href="/gu-zhi-gong-ju.html">估值工具</a>
      </li>
      <li class="post">
          <a href="/pa-chong-bi-ji.html">爬虫笔记</a>
      </li>
      <li class="post">
          <a href="/cai-wu-bao-biao.html">财务报表</a>
      </li>
      <li class="post">
          <a href="/tou-zi-ji-si-lu.html">投资集思录</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="/category/android_notes.html">Android_Notes</a></li>
        <li><a href="/category/financial_notes.html">Financial_Notes</a></li>
        <li><a href="/category/gu-zhi-gong-ju.html">估值工具</a></li>
        <li><a href="/category/java_notes.html">Java_Notes</a></li>
        <li><a href="/category/ji-suan-ji.html">计算机</a></li>
        <li><a href="/category/jie-zhi.html">价值</a></li>
        <li><a href="/category/life_notes.html">Life_Notes</a></li>
        <li><a href="/category/python_notes.html">Python_Notes</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="/tag/android.html">Android</a>,    <a href="/tag/sou-ji.html">搜集</a>,    <a href="/tag/gu-zhi.html">估值</a>,    <a href="/tag/gong-ju.html">工具</a>,    <a href="/tag/li-cai.html">理财</a>,    <a href="/tag/jin-rong.html">金融</a>,    <a href="/tag/uml.html">UML</a>,    <a href="/tag/kai-yuan.html">开源</a>,    <a href="/tag/du-shu.html">读书</a>,    <a href="/tag/xie-cheng.html">协程</a>  </section>


    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="#" target="_blank">You can add links in your config file</a></li>
            <li><a href="#" target="_blank">Another social link</a></li>
        </ul>
    </section>
    <section>
        <h1>Blogroll</h1>
        <ul>
            <li><a href="https://getpelican.com/" target="_blank">Pelican</a></li>
            <li><a href="https://www.python.org/" target="_blank">Python.org</a></li>
            <li><a href="https://palletsprojects.com/p/jinja/" target="_blank">Jinja2</a></li>
            <li><a href="#" target="_blank">You can modify those links in your config file</a></li>
        </ul>
    </section>

</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2020&ndash;2023  manymore13 &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="/theme/js/modernizr-2.0.js"></script>
  <script src="/theme/js/ender.js"></script>
  <script src="/theme/js/octopress.js" type="text/javascript"></script>
</body>
</html>