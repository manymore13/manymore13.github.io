<!DOCTYPE html>
<html lang="en">
        <head>
                        <meta charset="utf-8" />
                        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                        <meta name="generator" content="Pelican" />
                        <title>NIO笔记</title>
                        <link rel="stylesheet" href="/theme/css/main.css" />
    <meta name="description" content="技术 java tags: java NIO BIO 输入流就是把数据（键盘输入、鼠标、扫描仪等等外设设备）读入到内存（程序）中，输出流就是把内存（程序）中的 …" />
        </head>

        <body id="index" class="home">
                <header id="banner" class="body">
                        <h1><a href="/">manymore13'notes</a></h1>
                        <nav><ul>
                                                <li><a href="/category/android_notes.html">Android_Notes</a></li>
                                                <li><a href="/category/financial_notes.html">Financial_Notes</a></li>
                                                <li><a href="/category/gu-zhi-gong-ju.html">估值工具</a></li>
                                                <li class="active"><a href="/category/java_notes.html">Java_Notes</a></li>
                                                <li><a href="/category/ji-suan-ji.html">计算机</a></li>
                                                <li><a href="/category/jie-zhi.html">价值</a></li>
                                                <li><a href="/category/life_notes.html">Life_Notes</a></li>
                                                <li><a href="/category/python_notes.html">Python_Notes</a></li>
                        </ul></nav>
                </header><!-- /#banner -->
  <section id="content" class="body">
    <article>
      <header>
        <h1 class="entry-title">
          <a href="/niobi-ji.html" rel="bookmark"
             title="Permalink to NIO笔记">NIO笔记</a></h1>
      </header>

      <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-01-02T10:23:18+08:00">
                Published: Thu 02 January 2020
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="/author/manymore13.html">manymore13</a>
                </address>
        <p>In <a href="/category/java_notes.html">Java_Notes</a>.</p>
        
</footer><!-- /.post-info -->        <ul>
<li>技术</li>
<li>java
tags:</li>
<li>java</li>
<li>NIO</li>
</ul>
<hr>
<h2>BIO</h2>
<p>输入流就是把数据（键盘输入、鼠标、扫描仪等等外设设备）读入到内存（程序）中，输出流就是把内存（程序）中的数据输出到外设或其他地方，从文件角度简单总结就是，输入流就是读数据，输出流就是写数据。在这个过程中，始终把内存作为参考点。</p>
<h2>java NIO基本介绍</h2>
<ol>
<li>
<p>Java NIO 全称 java non-blocking IO，是指 JDK 提供的新 API。
从 JDK1.4 开始，Java 提供了一系列改进的输入/输出的新特性，被统称为 NIO(即 New IO)，是<strong>同步非阻塞</strong>的</p>
</li>
<li>
<p>NIO 有三大核心部分：Channel(通道)，Buffer(缓冲区), Selector(选择器) </p>
</li>
<li>
<p>NIO是 面向缓冲区 ，或者面向 块 编程的。数据读取到一个它稍后处理的缓冲区，
需要时可在缓冲区中前后移动，这就增加了处理过程中的灵活性，使用它可以提供非阻塞式的高伸缩性网络</p>
</li>
</ol>
<h2>NIO 和 BIO 的比较</h2>
<ol>
<li>BIO 以流的方式处理数据,而 NIO 以块的方式处理数据,块 I/O 的效率比流 I/O 高很多</li>
<li>BIO 是阻塞的，NIO 则是非阻塞的</li>
<li>BIO基于字节流和字符流进行操作，而 NIO 基于 Channel(通道)和 Buffer(缓冲区)进行操作，数据总是从通道读取到缓冲区中，或者从缓冲区写入到通道中。Selector(选择器)用于监听多个通道的事件（比如：连接请求，数据到达等），因此使用单个线程就可以监听多个客户端通道 </li>
</ol>
<h2>NIO 三大核心原理示意图</h2>
<p><img alt="nio原理图" src="../Other_Notes/img/nioylt.png"></p>
<ol>
<li>每个channel 都会对应一个Buffer</li>
<li>Selector 对应一个线程， 一个线程对应多个channel(连接)</li>
<li>该图反应了有三个channel 注册到 该selector //程序</li>
<li>程序切换到哪个channel 是有事件决定的, Event 就是一个重要的概念</li>
<li>Selector 会根据不同的事件，在各个通道上切换</li>
<li>Buffer 就是一个内存块 ， 底层是有一个数组</li>
<li>数据的读取写入是通过Buffer, 这个和BIO , BIO 中要么是输入流，或者是输出流, 不能双向，但是NIO的Buffer 是可以读也可以写, 需要 flip 方法切换</li>
<li>channel 是双向的, 可以返回底层操作系统的情况, 比如Linux ， 底层的操作系统通道就是双向的.</li>
</ol>
<h3>缓冲区(Buffer)</h3>
<p>缓冲区本质上是一个可以读写数据的内存块，可以理解成是一个容器对象(含数组)，该对象提供了一组方法，可以更轻松地使用内存块，
缓冲区对象内置了一些机制，能够跟踪和记录缓冲区的状态变化情况。
Channel 提供从文件、网络读取数据的渠道，但是读取或写入的数据都必须经由 Buffer</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Capacity</td>
<td>容量，即可以容纳的最大数据量；在缓冲区创建时被设定并且不能改变</td>
</tr>
<tr>
<td>Limit</td>
<td>表示缓冲区的当前终点，不能对缓冲区超过极限的位置进行读写操作。且极限是可以修改的</td>
</tr>
<tr>
<td>Position　</td>
<td>位置，下一个要被读或写的元素的索引，每次读写缓冲区数据时都会改变改值，为下次读写作准备</td>
</tr>
<tr>
<td>Mark</td>
<td>标记</td>
</tr>
</tbody>
</table>
<h3>通道(Channel)</h3>
<ol>
<li>NIO的通道类似于流，但有些区别如下：</li>
<li>通道可以同时进行读写，而流只能读或者只能写</li>
<li>通道可以实现异步读写数据</li>
<li>通道可以从缓冲读数据，也可以写数据到缓冲: </li>
<li>BIO 中的 stream 是单向的，例如 FileInputStream 对象只能进行读取数据的操作，而 NIO 中的通道(Channel)是双向的，可以读操作，也可以写操作。</li>
<li>常用的 Channel 类有：FileChannel、DatagramChannel、ServerSocketChannel 和 SocketChannel。【ServerSocketChanne 类似 ServerSocket , SocketChannel 类似 Socket】</li>
<li>FileChannel 用于文件的数据读写，DatagramChannel 用于 UDP 的数据读写，ServerSocketChannel 和 SocketChannel 用于 TCP 的数据读写。</li>
</ol>
<h4>FileChannel 类</h4>
<ul>
<li>FileChannel主要用来对本地文件进行 IO 操作，常见的方法有</li>
<li>public int read(ByteBuffer dst) ，从通道读取数据并放到缓冲区中</li>
<li>public int write(ByteBuffer src) ，把缓冲区的数据写到通道中</li>
<li>public long transferFrom(ReadableByteChannel src, long position, long count)，从目标通道中复制数据到当前通道</li>
<li>public long transferTo(long position, long count, WritableByteChannel target)，把数据从当前通道复制给目标通道</li>
</ul>
<h4>利用nio拷贝文件</h4>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fileInputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">&quot;1.txt&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">FileChannel</span><span class="w"> </span><span class="n">fileChannel01</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileInputStream</span><span class="p">.</span><span class="na">getChannel</span><span class="p">();</span>

<span class="w">        </span><span class="n">FileOutputStream</span><span class="w"> </span><span class="n">fileOutputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">&quot;2.txt&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">FileChannel</span><span class="w"> </span><span class="n">fileChannel02</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileOutputStream</span><span class="p">.</span><span class="na">getChannel</span><span class="p">();</span>

<span class="w">        </span><span class="n">ByteBuffer</span><span class="w"> </span><span class="n">byteBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ByteBuffer</span><span class="p">.</span><span class="na">allocate</span><span class="p">(</span><span class="mi">512</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//循环读取</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>

<span class="w">            </span><span class="c1">//这里有一个重要的操作，一定不要忘了</span>
<span class="w">            </span><span class="cm">/*</span>
<span class="cm">             public final Buffer clear() {</span>
<span class="cm">                position = 0;</span>
<span class="cm">                limit = capacity;</span>
<span class="cm">                mark = -1;</span>
<span class="cm">                return this;</span>
<span class="cm">            }</span>
<span class="cm">             */</span>
<span class="w">            </span><span class="n">byteBuffer</span><span class="p">.</span><span class="na">clear</span><span class="p">();</span><span class="w"> </span><span class="c1">//清空buffer</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileChannel01</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">byteBuffer</span><span class="p">);</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;read =&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">read</span><span class="p">);</span>
<span class="w">            </span><span class="c1">//表示读完</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">read</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">//将buffer 中的数据写入到 fileChannel02 -- 2.txt</span>
<span class="w">            </span><span class="n">byteBuffer</span><span class="p">.</span><span class="na">flip</span><span class="p">();</span>
<span class="w">            </span><span class="n">fileChannel02</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">byteBuffer</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">//关闭相关的流</span>
<span class="w">        </span><span class="n">fileInputStream</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="n">fileOutputStream</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>

<h4>拷贝文件transferFrom 方法</h4>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w">  </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">//创建相关流</span>
<span class="w">        </span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fileInputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="s">&quot;d:\\a.jpg&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">FileOutputStream</span><span class="w"> </span><span class="n">fileOutputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s">&quot;d:\\a2.jpg&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">//获取各个流对应的filechannel</span>
<span class="w">        </span><span class="n">FileChannel</span><span class="w"> </span><span class="n">sourceCh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileInputStream</span><span class="p">.</span><span class="na">getChannel</span><span class="p">();</span>
<span class="w">        </span><span class="n">FileChannel</span><span class="w"> </span><span class="n">destCh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileOutputStream</span><span class="p">.</span><span class="na">getChannel</span><span class="p">();</span>

<span class="w">        </span><span class="c1">//使用transferForm完成拷贝</span>
<span class="w">        </span><span class="n">destCh</span><span class="p">.</span><span class="na">transferFrom</span><span class="p">(</span><span class="n">sourceCh</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sourceCh</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
<span class="w">        </span><span class="c1">//关闭相关通道和流</span>
<span class="w">        </span><span class="n">sourceCh</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="n">destCh</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="n">fileInputStream</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="n">fileOutputStream</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div>
      </div><!-- /.entry-content -->

    </article>
  </section>
                <section id="extras" class="body">
                                <div class="blogroll">
                                        <h2>links</h2>
                                        <ul>
                                                        <li><a href="https://getpelican.com/">Pelican</a></li>
                                                        <li><a href="https://www.python.org/">Python.org</a></li>
                                                        <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                                                        <li><a href="#">You can modify those links in your config file</a></li>
                                        </ul>
                                </div><!-- /.blogroll -->
                                <div class="social">
                                        <h2>social</h2>
                                        <ul>

                                                        <li><a href="#">You can add links in your config file</a></li>
                                                        <li><a href="#">Another social link</a></li>
                                        </ul>
                                </div><!-- /.social -->
                </section><!-- /#extras -->

                <footer id="contentinfo" class="body">
                        <address id="about" class="vcard body">
                                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                        </address><!-- /#about -->

                        <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
                </footer><!-- /#contentinfo -->

        </body>
</html>